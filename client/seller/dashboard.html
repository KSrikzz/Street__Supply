<!DOCTYPE html>
<html>
<head>
  <title>Seller Dashboard</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <div class="container">
    <h2>Your Products</h2>
    <div id="productList"></div>

    <h3>Add Product</h3>
    <form id="addItemForm">
      <input type="text" id="pname" placeholder="Product Name" required />
      <input type="number" id="quantity" placeholder="Quantity" required />
      <input type="number" id="price" placeholder="Price" required />
      <button type="submit">Add Product</button>
    </form>

    <h3>Orders Received</h3>
    <ul id="orderList"></ul>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", async () => {
  const token = localStorage.getItem("token");

  if (!token) {
    alert("Please log in first.");
    window.location.href = "../sellerLogin.html";
    return;
  }

  const fetchItems = async () => {
    const res = await fetch("http://localhost:5000/api/products/mine", {
      headers: { Authorization: `Bearer ${token}` }
    });
    const items = await res.json();
    const itemList = document.getElementById("productList");
    itemList.innerHTML = "";

    items.forEach(item => {
      const li = document.createElement("li");
      li.innerHTML = `
        ${item.name} - â‚¹${item.price} (Qty: ${item.quantity})
        <button data-id="${item._id}" class="editBtn">Edit</button>
        <button data-id="${item._id}" class="deleteBtn">Delete</button>
      `;
      itemList.appendChild(li);
    });

    document.querySelectorAll(".deleteBtn").forEach(btn =>
      btn.addEventListener("click", async () => {
        const id = btn.getAttribute("data-id");
        const res = await fetch(`http://localhost:5000/api/products/${id}`, {
          method: "DELETE",
          headers: { Authorization: `Bearer ${token}` }
        });
        const data = await res.json();
        if (res.ok) fetchItems();
        else alert(data.message);
      })
    );
  };

  fetchItems();

  document.getElementById("addItemForm").addEventListener("submit", async e => {
    e.preventDefault();
    const name = document.getElementById("itemName").value;
    const quantity = document.getElementById("itemQuantity").value;
    const price = document.getElementById("itemPrice").value;

    const res = await fetch("http://localhost:5000/api/products", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`
      },
      body: JSON.stringify({ name, quantity, price })
    });

    const data = await res.json();
    if (res.ok) {
      alert("Item added!");
      fetchItems();
    } else alert(data.message);
  });
});

  </script>
</body>
</html>
